!function(t,w){"object"==typeof exports&&"undefined"!=typeof module?w(exports):"function"==typeof define&&define.amd?define(["exports"],w):w((t.Leaflet=t.Leaflet||{},t.Leaflet.markercluster=t.Leaflet.markercluster||{}))}(this,function(t){var w=L.MarkerClusterGroup=L.FeatureGroup.extend({options:{maxClusterRadius:80,iconCreateFunction:null,clusterPane:L.Marker.prototype.options.pane,spiderfyOnMaxZoom:!0,showCoverageOnHover:!0,zoomToBoundsOnClick:!0,singleMarkerMode:!1,disableClusteringAtZoom:null,
removeOutsideVisibleBounds:!0,animate:!0,animateAddingMarkers:!1,spiderfyDistanceMultiplier:1,spiderLegPolylineOptions:{weight:1.5,color:"#222",opacity:.5},chunkedLoading:!1,chunkInterval:200,chunkDelay:50,chunkProgress:null,polygonOptions:{}},initialize:function(a){L.Util.setOptions(this,a);this.options.iconCreateFunction||(this.options.iconCreateFunction=this._defaultIconCreateFunction);this._featureGroup=L.featureGroup();this._featureGroup.addEventParent(this);this._nonPointGroup=L.featureGroup();
this._nonPointGroup.addEventParent(this);this._inZoomAnimation=0;this._needsClustering=[];this._needsRemoving=[];this._currentShownBounds=null;this._queue=[];this._childMarkerEventHandlers={dragstart:this._childMarkerDragStart,move:this._childMarkerMoved,dragend:this._childMarkerDragEnd};a=L.DomUtil.TRANSITION&&this.options.animate;L.extend(this,a?this._withAnimation:this._noAnimation);this._markerCluster=a?L.MarkerCluster:L.MarkerClusterNonAnimated},addLayer:function(a){if(a instanceof L.LayerGroup)return this.addLayers([a]);
if(!a.getLatLng)return this._nonPointGroup.addLayer(a),this.fire("layeradd",{layer:a}),this;if(!this._map)return this._needsClustering.push(a),this.fire("layeradd",{layer:a}),this;if(this.hasLayer(a))return this;this._unspiderfy&&this._unspiderfy();this._addLayer(a,this._maxZoom);this.fire("layeradd",{layer:a});this._topClusterLevel._recalculateBounds();this._refreshClustersIcons();var b=a,c=this._zoom;if(a.__parent)for(;b.__parent._zoom>=c;)b=b.__parent;return this._currentShownBounds.contains(b.getLatLng())&&
(this.options.animateAddingMarkers?this._animationAddLayer(a,b):this._animationAddLayerNonAnimated(a,b)),this},removeLayer:function(a){return a instanceof L.LayerGroup?this.removeLayers([a]):a.getLatLng?this._map?a.__parent?(this._unspiderfy&&(this._unspiderfy(),this._unspiderfyLayer(a)),this._removeLayer(a,!0),this.fire("layerremove",{layer:a}),this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),a.off(this._childMarkerEventHandlers,this),this._featureGroup.hasLayer(a)&&(this._featureGroup.removeLayer(a),
a.clusterShow&&a.clusterShow()),this):this:(!this._arraySplice(this._needsClustering,a)&&this.hasLayer(a)&&this._needsRemoving.push({layer:a,latlng:a._latlng}),this.fire("layerremove",{layer:a}),this):(this._nonPointGroup.removeLayer(a),this.fire("layerremove",{layer:a}),this)},addLayers:function(a,b){if(!L.Util.isArray(a))return this.addLayer(a);var c=this._featureGroup,d=this._nonPointGroup,f=this.options.chunkedLoading,g=this.options.chunkInterval,e=this.options.chunkProgress,h=a.length,m=0,k=
!0;if(this._map){var p=(new Date).getTime(),r=L.bind(function(){for(var q=(new Date).getTime();h>m&&!(f&&0===m%200&&(new Date).getTime()-q>g);m++)if(n=a[m],n instanceof L.LayerGroup)k&&(a=a.slice(),k=!1),this._extractNonGroupLayers(n,a),h=a.length;else if(n.getLatLng){if(!this.hasLayer(n)&&(this._addLayer(n,this._maxZoom),b||this.fire("layeradd",{layer:n}),n.__parent&&2===n.__parent.getChildCount())){var u=n.__parent.getAllChildMarkers();c.removeLayer(u[0]===n?u[1]:u[0])}}else d.addLayer(n),b||this.fire("layeradd",
{layer:n});e&&e(m,h,(new Date).getTime()-p);m===h?(this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds)):setTimeout(r,this.options.chunkDelay)},this);r()}else for(var l=this._needsClustering;h>m;m++){var n=a[m];n instanceof L.LayerGroup?(k&&(a=a.slice(),k=!1),this._extractNonGroupLayers(n,a),h=a.length):n.getLatLng?this.hasLayer(n)||l.push(n):d.addLayer(n)}return this},removeLayers:function(a){var b,
c=a.length,d=this._featureGroup,f=this._nonPointGroup,g=!0;if(!this._map){for(b=0;c>b;b++){var e=a[b];e instanceof L.LayerGroup?(g&&(a=a.slice(),g=!1),this._extractNonGroupLayers(e,a),c=a.length):(this._arraySplice(this._needsClustering,e),f.removeLayer(e),this.hasLayer(e)&&this._needsRemoving.push({layer:e,latlng:e._latlng}),this.fire("layerremove",{layer:e}))}return this}if(this._unspiderfy){this._unspiderfy();var h=a.slice(),m=c;for(b=0;m>b;b++)e=h[b],e instanceof L.LayerGroup?(this._extractNonGroupLayers(e,
h),m=h.length):this._unspiderfyLayer(e)}for(b=0;c>b;b++)e=a[b],e instanceof L.LayerGroup?(g&&(a=a.slice(),g=!1),this._extractNonGroupLayers(e,a),c=a.length):e.__parent?(this._removeLayer(e,!0,!0),this.fire("layerremove",{layer:e}),d.hasLayer(e)&&(d.removeLayer(e),e.clusterShow&&e.clusterShow())):(f.removeLayer(e),this.fire("layerremove",{layer:e}));return this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds),
this},clearLayers:function(){return this._map||(this._needsClustering=[],this._needsRemoving=[],delete this._gridClusters,delete this._gridUnclustered),this._noanimationUnspiderfy&&this._noanimationUnspiderfy(),this._featureGroup.clearLayers(),this._nonPointGroup.clearLayers(),this.eachLayer(function(a){a.off(this._childMarkerEventHandlers,this);delete a.__parent},this),this._map&&this._generateInitialClusters(),this},getBounds:function(){var a=new L.LatLngBounds;this._topClusterLevel&&a.extend(this._topClusterLevel._bounds);
for(var b=this._needsClustering.length-1;0<=b;b--)a.extend(this._needsClustering[b].getLatLng());return a.extend(this._nonPointGroup.getBounds()),a},eachLayer:function(a,b){var c,d,f=this._needsClustering.slice(),g=this._needsRemoving;this._topClusterLevel&&this._topClusterLevel.getAllChildMarkers(f);for(c=f.length-1;0<=c;c--){var e=!0;for(d=g.length-1;0<=d;d--)if(g[d].layer===f[c]){e=!1;break}e&&a.call(b,f[c])}this._nonPointGroup.eachLayer(a,b)},getLayers:function(){var a=[];return this.eachLayer(function(b){a.push(b)}),
a},getLayer:function(a){var b=null;return a=parseInt(a,10),this.eachLayer(function(c){L.stamp(c)===a&&(b=c)}),b},hasLayer:function(a){if(!a)return!1;var b,c=this._needsClustering;for(b=c.length-1;0<=b;b--)if(c[b]===a)return!0;c=this._needsRemoving;for(b=c.length-1;0<=b;b--)if(c[b].layer===a)return!1;return!(!a.__parent||a.__parent._group!==this)||this._nonPointGroup.hasLayer(a)},zoomToShowLayer:function(a,b){"function"!=typeof b&&(b=function(){});var c=function(){!a._icon&&!a.__parent._icon||this._inZoomAnimation||
(this._map.off("moveend",c,this),this.off("animationend",c,this),a._icon?b():a.__parent._icon&&(this.once("spiderfied",b,this),a.__parent.spiderfy()))};a._icon&&this._map.getBounds().contains(a.getLatLng())?b():a.__parent._zoom<Math.round(this._map._zoom)?(this._map.on("moveend",c,this),this._map.panTo(a.getLatLng())):(this._map.on("moveend",c,this),this.on("animationend",c,this),a.__parent.zoomToBounds())},onAdd:function(a){this._map=a;var b;if(!isFinite(this._map.getMaxZoom()))throw"Map has no maxZoom specified";
this._featureGroup.addTo(a);this._nonPointGroup.addTo(a);this._gridClusters||this._generateInitialClusters();this._maxLat=a.options.crs.projection.MAX_LATITUDE;a=0;for(b=this._needsRemoving.length;b>a;a++){var c=this._needsRemoving[a];c.newlatlng=c.layer._latlng;c.layer._latlng=c.latlng}a=0;for(b=this._needsRemoving.length;b>a;a++)c=this._needsRemoving[a],this._removeLayer(c.layer,!0),c.layer._latlng=c.newlatlng;this._needsRemoving=[];this._zoom=Math.round(this._map._zoom);this._currentShownBounds=
this._getExpandedVisibleBounds();this._map.on("zoomend",this._zoomEnd,this);this._map.on("moveend",this._moveEnd,this);this._spiderfierOnAdd&&this._spiderfierOnAdd();this._bindEvents();b=this._needsClustering;this._needsClustering=[];this.addLayers(b,!0)},onRemove:function(a){a.off("zoomend",this._zoomEnd,this);a.off("moveend",this._moveEnd,this);this._unbindEvents();this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim","");this._spiderfierOnRemove&&this._spiderfierOnRemove();
delete this._maxLat;this._hideCoverage();this._featureGroup.remove();this._nonPointGroup.remove();this._featureGroup.clearLayers();this._map=null},getVisibleParent:function(a){for(;a&&!a._icon;)a=a.__parent;return a||null},_arraySplice:function(a,b){for(var c=a.length-1;0<=c;c--)if(a[c]===b)return a.splice(c,1),!0},_removeFromGridUnclustered:function(a,b){for(var c=this._map,d=this._gridUnclustered,f=Math.floor(this._map.getMinZoom());b>=f&&d[b].removeObject(a,c.project(a.getLatLng(),b));b--);},_childMarkerDragStart:function(a){a.target.__dragStart=
a.target._latlng},_childMarkerMoved:function(a){if(!this._ignoreMove&&!a.target.__dragStart){var b=a.target._popup&&a.target._popup.isOpen();this._moveChild(a.target,a.oldLatLng,a.latlng);b&&a.target.openPopup()}},_moveChild:function(a,b,c){a._latlng=b;this.removeLayer(a);a._latlng=c;this.addLayer(a)},_childMarkerDragEnd:function(a){var b=a.target.__dragStart;delete a.target.__dragStart;b&&this._moveChild(a.target,b,a.target._latlng)},_removeLayer:function(a,b,c){var d=this._gridClusters,f=this._gridUnclustered,
g=this._featureGroup,e=this._map,h=Math.floor(this._map.getMinZoom());b&&this._removeFromGridUnclustered(a,this._maxZoom);var m,k=a.__parent;for(this._arraySplice(k._markers,a);k&&(k._childCount--,k._boundsNeedUpdate=!0,!(k._zoom<h));)b&&1>=k._childCount?(m=k._markers[0]===a?k._markers[1]:k._markers[0],d[k._zoom].removeObject(k,e.project(k._cLatLng,k._zoom)),f[k._zoom].addObject(m,e.project(m.getLatLng(),k._zoom)),this._arraySplice(k.__parent._childClusters,k),k.__parent._markers.push(m),m.__parent=
k.__parent,k._icon&&(g.removeLayer(k),c||g.addLayer(m))):k._iconNeedsUpdate=!0,k=k.__parent;delete a.__parent},_isOrIsParent:function(a,b){for(;b;){if(a===b)return!0;b=b.parentNode}return!1},fire:function(a,b,c){if(b&&b.layer instanceof L.MarkerCluster){if(b.originalEvent&&this._isOrIsParent(b.layer._icon,b.originalEvent.relatedTarget))return;a="cluster"+a}L.FeatureGroup.prototype.fire.call(this,a,b,c)},listens:function(a,b){return L.FeatureGroup.prototype.listens.call(this,a,b)||L.FeatureGroup.prototype.listens.call(this,
"cluster"+a,b)},_defaultIconCreateFunction:function(a){a=a.getChildCount();var b=" marker-cluster-";return b+=10>a?"small":100>a?"medium":"large",new L.DivIcon({html:"<div><span>"+a+"</span></div>",className:"marker-cluster"+b,iconSize:new L.Point(40,40)})},_bindEvents:function(){var a=this._map,b=this.options.showCoverageOnHover,c=this.options.zoomToBoundsOnClick;(this.options.spiderfyOnMaxZoom||c)&&this.on("clusterclick",this._zoomOrSpiderfy,this);b&&(this.on("clustermouseover",this._showCoverage,
this),this.on("clustermouseout",this._hideCoverage,this),a.on("zoomend",this._hideCoverage,this))},_zoomOrSpiderfy:function(a){for(var b=a.layer,c=b;1===c._childClusters.length;)c=c._childClusters[0];c._zoom===this._maxZoom&&c._childCount===b._childCount&&this.options.spiderfyOnMaxZoom?b.spiderfy():this.options.zoomToBoundsOnClick&&b.zoomToBounds();a.originalEvent&&13===a.originalEvent.keyCode&&this._map._container.focus()},_showCoverage:function(a){var b=this._map;this._inZoomAnimation||(this._shownPolygon&&
b.removeLayer(this._shownPolygon),2<a.layer.getChildCount()&&a.layer!==this._spiderfied&&(this._shownPolygon=new L.Polygon(a.layer.getConvexHull(),this.options.polygonOptions),b.addLayer(this._shownPolygon)))},_hideCoverage:function(){this._shownPolygon&&(this._map.removeLayer(this._shownPolygon),this._shownPolygon=null)},_unbindEvents:function(){var a=this.options.showCoverageOnHover,b=this.options.zoomToBoundsOnClick,c=this._map;(this.options.spiderfyOnMaxZoom||b)&&this.off("clusterclick",this._zoomOrSpiderfy,
this);a&&(this.off("clustermouseover",this._showCoverage,this),this.off("clustermouseout",this._hideCoverage,this),c.off("zoomend",this._hideCoverage,this))},_zoomEnd:function(){this._map&&(this._mergeSplitClusters(),this._zoom=Math.round(this._map._zoom),this._currentShownBounds=this._getExpandedVisibleBounds())},_moveEnd:function(){if(!this._inZoomAnimation){var a=this._getExpandedVisibleBounds();this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),
this._zoom,a);this._topClusterLevel._recursivelyAddChildrenToMap(null,Math.round(this._map._zoom),a);this._currentShownBounds=a}},_generateInitialClusters:function(){var a=Math.ceil(this._map.getMaxZoom()),b=Math.floor(this._map.getMinZoom()),c=this.options.maxClusterRadius,d=c;"function"!=typeof c&&(d=function(){return c});null!==this.options.disableClusteringAtZoom&&(a=this.options.disableClusteringAtZoom-1);this._maxZoom=a;this._gridClusters={};for(this._gridUnclustered={};a>=b;a--)this._gridClusters[a]=
new L.DistanceGrid(d(a)),this._gridUnclustered[a]=new L.DistanceGrid(d(a));this._topClusterLevel=new this._markerCluster(this,b-1)},_addLayer:function(a,b){var c=this._gridClusters,d=this._gridUnclustered,f=Math.floor(this._map.getMinZoom());this.options.singleMarkerMode&&this._overrideMarkerIcon(a);for(a.on(this._childMarkerEventHandlers,this);b>=f;b--){var g=this._map.project(a.getLatLng(),b);var e=c[b].getNearObject(g);if(e)return e._addChild(a),a.__parent=e,void 0;if(e=d[b].getNearObject(g)){(g=
e.__parent)&&this._removeLayer(e,!1);d=new this._markerCluster(this,b,e,a);c[b].addObject(d,this._map.project(d._cLatLng,b));e.__parent=d;a.__parent=d;for(a=b-1;a>g._zoom;a--)d=new this._markerCluster(this,a,d),c[a].addObject(d,this._map.project(e.getLatLng(),a));return g._addChild(d),this._removeFromGridUnclustered(e,b),void 0}d[b].addObject(a,g)}this._topClusterLevel._addChild(a);a.__parent=this._topClusterLevel},_refreshClustersIcons:function(){this._featureGroup.eachLayer(function(a){a instanceof
L.MarkerCluster&&a._iconNeedsUpdate&&a._updateIcon()})},_enqueue:function(a){this._queue.push(a);this._queueTimeout||(this._queueTimeout=setTimeout(L.bind(this._processQueue,this),300))},_processQueue:function(){for(var a=0;a<this._queue.length;a++)this._queue[a].call(this);this._queue.length=0;clearTimeout(this._queueTimeout);this._queueTimeout=null},_mergeSplitClusters:function(){var a=Math.round(this._map._zoom);this._processQueue();this._zoom<a&&this._currentShownBounds.intersects(this._getExpandedVisibleBounds())?
(this._animationStart(),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),this._zoom,this._getExpandedVisibleBounds()),this._animationZoomIn(this._zoom,a)):this._zoom>a?(this._animationStart(),this._animationZoomOut(this._zoom,a)):this._moveEnd()},_getExpandedVisibleBounds:function(){return this.options.removeOutsideVisibleBounds?L.Browser.mobile?this._checkBoundsMaxLat(this._map.getBounds()):this._checkBoundsMaxLat(this._map.getBounds().pad(1)):
this._mapBoundsInfinite},_checkBoundsMaxLat:function(a){var b=this._maxLat;return void 0!==b&&(a.getNorth()>=b&&(a._northEast.lat=1/0),a.getSouth()<=-b&&(a._southWest.lat=-1/0)),a},_animationAddLayerNonAnimated:function(a,b){b===a?this._featureGroup.addLayer(a):2===b._childCount?(b._addToMap(),a=b.getAllChildMarkers(),this._featureGroup.removeLayer(a[0]),this._featureGroup.removeLayer(a[1])):b._updateIcon()},_extractNonGroupLayers:function(a,b){var c=a.getLayers(),d=0;for(b=b||[];d<c.length;d++)a=
c[d],a instanceof L.LayerGroup?this._extractNonGroupLayers(a,b):b.push(a);return b},_overrideMarkerIcon:function(a){return a.options.icon=this.options.iconCreateFunction({getChildCount:function(){return 1},getAllChildMarkers:function(){return[a]}})}});L.MarkerClusterGroup.include({_mapBoundsInfinite:new L.LatLngBounds(new L.LatLng(-1/0,-1/0),new L.LatLng(1/0,1/0))});L.MarkerClusterGroup.include({_noAnimation:{_animationStart:function(){},_animationZoomIn:function(a,b){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,
Math.floor(this._map.getMinZoom()),a);this._topClusterLevel._recursivelyAddChildrenToMap(null,b,this._getExpandedVisibleBounds());this.fire("animationend")},_animationZoomOut:function(a,b){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),a);this._topClusterLevel._recursivelyAddChildrenToMap(null,b,this._getExpandedVisibleBounds());this.fire("animationend")},_animationAddLayer:function(a,b){this._animationAddLayerNonAnimated(a,b)}},
_withAnimation:{_animationStart:function(){this._map._mapPane.className+=" leaflet-cluster-anim";this._inZoomAnimation++},_animationZoomIn:function(a,b){var c,d=this._getExpandedVisibleBounds(),f=this._featureGroup,g=Math.floor(this._map.getMinZoom());this._ignoreMove=!0;this._topClusterLevel._recursively(d,a,g,function(e){var h=e._latlng,m=e._markers;d.contains(h)||(h=null);e._isSingleParent()&&a+1===b?(f.removeLayer(e),e._recursivelyAddChildrenToMap(null,b,d)):(e.clusterHide(),e._recursivelyAddChildrenToMap(h,
b,d));for(c=m.length-1;0<=c;c--)e=m[c],d.contains(e._latlng)||f.removeLayer(e)});this._forceLayout();this._topClusterLevel._recursivelyBecomeVisible(d,b);f.eachLayer(function(e){e instanceof L.MarkerCluster||!e._icon||e.clusterShow()});this._topClusterLevel._recursively(d,a,b,function(e){e._recursivelyRestoreChildPositions(b)});this._ignoreMove=!1;this._enqueue(function(){this._topClusterLevel._recursively(d,a,g,function(e){f.removeLayer(e);e.clusterShow()});this._animationEnd()})},_animationZoomOut:function(a,
b){this._animationZoomOutSingle(this._topClusterLevel,a-1,b);this._topClusterLevel._recursivelyAddChildrenToMap(null,b,this._getExpandedVisibleBounds());this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),a,this._getExpandedVisibleBounds())},_animationAddLayer:function(a,b){var c=this,d=this._featureGroup;d.addLayer(a);b!==a&&(2<b._childCount?(b._updateIcon(),this._forceLayout(),this._animationStart(),a._setPos(this._map.latLngToLayerPoint(b.getLatLng())),
a.clusterHide(),this._enqueue(function(){d.removeLayer(a);a.clusterShow();c._animationEnd()})):(this._forceLayout(),c._animationStart(),c._animationZoomOutSingle(b,this._map.getMaxZoom(),this._zoom)))}},_animationZoomOutSingle:function(a,b,c){var d=this._getExpandedVisibleBounds(),f=Math.floor(this._map.getMinZoom());a._recursivelyAnimateChildrenInAndAddSelfToMap(d,f,b+1,c);var g=this;this._forceLayout();a._recursivelyBecomeVisible(d,c);this._enqueue(function(){if(1===a._childCount){var e=a._markers[0];
this._ignoreMove=!0;e.setLatLng(e.getLatLng());this._ignoreMove=!1;e.clusterShow&&e.clusterShow()}else a._recursively(d,c,f,function(h){h._recursivelyRemoveChildrenFromMap(d,f,b+1)});g._animationEnd()})},_animationEnd:function(){this._map&&(this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim",""));this._inZoomAnimation--;this.fire("animationend")},_forceLayout:function(){L.Util.falseFn(document.body.offsetWidth)}});L.markerClusterGroup=function(a){return new L.MarkerClusterGroup(a)};
var x=L.MarkerCluster=L.Marker.extend({options:L.Icon.prototype.options,initialize:function(a,b,c,d){L.Marker.prototype.initialize.call(this,c?c._cLatLng||c.getLatLng():new L.LatLng(0,0),{icon:this,pane:a.options.clusterPane});this._group=a;this._zoom=b;this._markers=[];this._childClusters=[];this._childCount=0;this._boundsNeedUpdate=this._iconNeedsUpdate=!0;this._bounds=new L.LatLngBounds;c&&this._addChild(c);d&&this._addChild(d)},getAllChildMarkers:function(a,b){a=a||[];for(var c=this._childClusters.length-
1;0<=c;c--)this._childClusters[c].getAllChildMarkers(a);for(c=this._markers.length-1;0<=c;c--)b&&this._markers[c].__dragStart||a.push(this._markers[c]);return a},getChildCount:function(){return this._childCount},zoomToBounds:function(a){var b=this._childClusters.slice();var c=this._group._map;for(var d=c.getBoundsZoom(this._bounds),f=this._zoom+1,g=c.getZoom();0<b.length&&d>f;){f++;var e=[];for(c=0;c<b.length;c++)e=e.concat(b[c]._childClusters);b=e}d>f?this._group._map.setView(this._latlng,f):g>=
d?this._group._map.setView(this._latlng,g+1):this._group._map.fitBounds(this._bounds,a)},getBounds:function(){var a=new L.LatLngBounds;return a.extend(this._bounds),a},_updateIcon:function(){this._iconNeedsUpdate=!0;this._icon&&this.setIcon(this)},createIcon:function(){return this._iconNeedsUpdate&&(this._iconObj=this._group.options.iconCreateFunction(this),this._iconNeedsUpdate=!1),this._iconObj.createIcon()},createShadow:function(){return this._iconObj.createShadow()},_addChild:function(a,b){this._boundsNeedUpdate=
this._iconNeedsUpdate=!0;this._setClusterCenter(a);a instanceof L.MarkerCluster?(b||(this._childClusters.push(a),a.__parent=this),this._childCount+=a._childCount):(b||this._markers.push(a),this._childCount++);this.__parent&&this.__parent._addChild(a,!0)},_setClusterCenter:function(a){this._cLatLng||(this._cLatLng=a._cLatLng||a._latlng)},_resetBounds:function(){var a=this._bounds;a._southWest&&(a._southWest.lat=1/0,a._southWest.lng=1/0);a._northEast&&(a._northEast.lat=-1/0,a._northEast.lng=-1/0)},
_recalculateBounds:function(){var a;var b=this._markers;var c=this._childClusters,d=0,f=0,g=this._childCount;if(0!==g){this._resetBounds();for(a=0;a<b.length;a++){var e=b[a]._latlng;this._bounds.extend(e);d+=e.lat;f+=e.lng}for(a=0;a<c.length;a++)b=c[a],b._boundsNeedUpdate&&b._recalculateBounds(),this._bounds.extend(b._bounds),e=b._wLatLng,b=b._childCount,d+=e.lat*b,f+=e.lng*b;this._latlng=this._wLatLng=new L.LatLng(d/g,f/g);this._boundsNeedUpdate=!1}},_addToMap:function(a){a&&(this._backupLatlng=
this._latlng,this.setLatLng(a));this._group._featureGroup.addLayer(this)},_recursivelyAnimateChildrenIn:function(a,b,c){this._recursively(a,this._group._map.getMinZoom(),c-1,function(d){var f=d._markers;for(d=f.length-1;0<=d;d--){var g=f[d];g._icon&&(g._setPos(b),g.clusterHide())}},function(d){var f=d._childClusters;for(d=f.length-1;0<=d;d--){var g=f[d];g._icon&&(g._setPos(b),g.clusterHide())}})},_recursivelyAnimateChildrenInAndAddSelfToMap:function(a,b,c,d){this._recursively(a,d,b,function(f){f._recursivelyAnimateChildrenIn(a,
f._group._map.latLngToLayerPoint(f.getLatLng()).round(),c);f._isSingleParent()&&c-1===d?(f.clusterShow(),f._recursivelyRemoveChildrenFromMap(a,b,c)):f.clusterHide();f._addToMap()})},_recursivelyBecomeVisible:function(a,b){this._recursively(a,this._group._map.getMinZoom(),b,null,function(c){c.clusterShow()})},_recursivelyAddChildrenToMap:function(a,b,c){this._recursively(c,this._group._map.getMinZoom()-1,b,function(d){if(b!==d._zoom)for(var f=d._markers.length-1;0<=f;f--){var g=d._markers[f];c.contains(g._latlng)&&
(a&&(g._backupLatlng=g.getLatLng(),g.setLatLng(a),g.clusterHide&&g.clusterHide()),d._group._featureGroup.addLayer(g))}},function(d){d._addToMap(a)})},_recursivelyRestoreChildPositions:function(a){for(var b=this._markers.length-1;0<=b;b--){var c=this._markers[b];c._backupLatlng&&(c.setLatLng(c._backupLatlng),delete c._backupLatlng)}if(a-1===this._zoom)for(a=this._childClusters.length-1;0<=a;a--)this._childClusters[a]._restorePosition();else for(b=this._childClusters.length-1;0<=b;b--)this._childClusters[b]._recursivelyRestoreChildPositions(a)},
_restorePosition:function(){this._backupLatlng&&(this.setLatLng(this._backupLatlng),delete this._backupLatlng)},_recursivelyRemoveChildrenFromMap:function(a,b,c,d){var f,g;this._recursively(a,b-1,c-1,function(e){for(g=e._markers.length-1;0<=g;g--)f=e._markers[g],d&&d.contains(f._latlng)||(e._group._featureGroup.removeLayer(f),f.clusterShow&&f.clusterShow())},function(e){for(g=e._childClusters.length-1;0<=g;g--)f=e._childClusters[g],d&&d.contains(f._latlng)||(e._group._featureGroup.removeLayer(f),
f.clusterShow&&f.clusterShow())})},_recursively:function(a,b,c,d,f){var g=this._childClusters;var e=this._zoom;if(e>=b&&(d&&d(this),f&&e===c&&f(this)),b>e||c>e)for(e=g.length-1;0<=e;e--){var h=g[e];h._boundsNeedUpdate&&h._recalculateBounds();a.intersects(h._bounds)&&h._recursively(a,b,c,d,f)}},_isSingleParent:function(){return 0<this._childClusters.length&&this._childClusters[0]._childCount===this._childCount}});L.Marker.include({clusterHide:function(){var a=this.options.opacity;return this.setOpacity(0),
this.options.opacity=a,this},clusterShow:function(){return this.setOpacity(this.options.opacity)}});L.DistanceGrid=function(a){this._cellSize=a;this._sqCellSize=a*a;this._grid={};this._objectPoint={}};L.DistanceGrid.prototype={addObject:function(a,b){var c=this._getCoord(b.x),d=this._getCoord(b.y),f=this._grid;d=f[d]=f[d]||{};c=d[c]=d[c]||[];d=L.Util.stamp(a);this._objectPoint[d]=b;c.push(a)},updateObject:function(a,b){this.removeObject(a);this.addObject(a,b)},removeObject:function(a,b){var c=this._getCoord(b.x);
b=this._getCoord(b.y);var d=this._grid;var f=d[b]=d[b]||{},g=f[c]=f[c]||[];delete this._objectPoint[L.Util.stamp(a)];b=0;for(d=g.length;d>b;b++)if(g[b]===a)return g.splice(b,1),1===d&&delete f[c],!0},eachObject:function(a,b){var c,d,f,g,e=this._grid;for(c in e){var h=e[c];for(d in h){var m=h[d];var k=0;for(f=m.length;f>k;k++)(g=a.call(b,m[k]))&&(k--,f--)}}},getNearObject:function(a){var b,c,d,f,g,e=this._getCoord(a.x),h=this._getCoord(a.y),m=this._objectPoint,k=this._sqCellSize,p=null;for(b=h-1;h+
1>=b;b++)if(d=this._grid[b])for(c=e-1;e+1>=c;c++)if(f=d[c]){var r=0;for(g=f.length;g>r;r++){var l=f[r];var n=this._sqDist(m[L.Util.stamp(l)],a);(k>n||k>=n&&null===p)&&(k=n,p=l)}}return p},_getCoord:function(a){var b=Math.floor(a/this._cellSize);return isFinite(b)?b:a},_sqDist:function(a,b){var c=b.x-a.x;a=b.y-a.y;return c*c+a*a}};(function(){L.QuickHull={getDistant:function(a,b){return(b[0].lng-b[1].lng)*(a.lat-b[0].lat)+(b[1].lat-b[0].lat)*(a.lng-b[0].lng)},findMostDistantPointFromBaseLine:function(a,
b){var c,d=0,f=null,g=[];for(c=b.length-1;0<=c;c--){var e=b[c];var h=this.getDistant(e,a);0<h&&(g.push(e),h>d&&(d=h,f=e))}return{maxPoint:f,newPoints:g}},buildConvexHull:function(a,b){var c=[];b=this.findMostDistantPointFromBaseLine(a,b);return b.maxPoint?(c=c.concat(this.buildConvexHull([a[0],b.maxPoint],b.newPoints)),c.concat(this.buildConvexHull([b.maxPoint,a[1]],b.newPoints))):[a[0]]},getConvexHull:function(a){var b,c=!1,d=!1,f=!1,g=!1,e=null,h=null,m=null,k=null,p=null,r=null;for(b=a.length-
1;0<=b;b--){var l=a[b];(!1===c||l.lat>c)&&(e=l,c=l.lat);(!1===d||l.lat<d)&&(h=l,d=l.lat);(!1===f||l.lng>f)&&(m=l,f=l.lng);(!1===g||l.lng<g)&&(k=l,g=l.lng)}d!==c?(r=h,p=e):(r=k,p=m);return[].concat(this.buildConvexHull([r,p],a),this.buildConvexHull([p,r],a))}}})();L.MarkerCluster.include({getConvexHull:function(){var a,b=this.getAllChildMarkers(),c=[];for(a=b.length-1;0<=a;a--){var d=b[a].getLatLng();c.push(d)}return L.QuickHull.getConvexHull(c)}});L.MarkerCluster.include({_2PI:2*Math.PI,_circleFootSeparation:25,
_circleStartAngle:0,_spiralFootSeparation:28,_spiralLengthStart:11,_spiralLengthFactor:5,_circleSpiralSwitchover:9,spiderfy:function(){if(this._group._spiderfied!==this&&!this._group._inZoomAnimation){var a,b=this.getAllChildMarkers(null,!0),c=this._group._map.latLngToLayerPoint(this._latlng);this._group._unspiderfy();this._group._spiderfied=this;b.length>=this._circleSpiralSwitchover?a=this._generatePointsSpiral(b.length,c):(c.y+=10,a=this._generatePointsCircle(b.length,c));this._animationSpiderfy(b,
a)}},unspiderfy:function(a){this._group._inZoomAnimation||(this._animationUnspiderfy(a),this._group._spiderfied=null)},_generatePointsCircle:function(a,b){var c,d=this._group.options.spiderfyDistanceMultiplier*this._circleFootSeparation*(2+a)/this._2PI,f=this._2PI/a,g=[];d=Math.max(d,35);g.length=a;for(c=0;a>c;c++){var e=this._circleStartAngle+c*f;g[c]=(new L.Point(b.x+d*Math.cos(e),b.y+d*Math.sin(e)))._round()}return g},_generatePointsSpiral:function(a,b){var c=this._group.options.spiderfyDistanceMultiplier;
var d=c*this._spiralLengthStart,f=c*this._spiralFootSeparation,g=c*this._spiralLengthFactor*this._2PI,e=0,h=[];for(c=h.length=a;0<=c;c--)a>c&&(h[c]=(new L.Point(b.x+d*Math.cos(e),b.y+d*Math.sin(e)))._round()),e+=f/d+5E-4*c,d+=g/e;return h},_noanimationUnspiderfy:function(){var a,b=this._group,c=b._map,d=b._featureGroup,f=this.getAllChildMarkers(null,!0);b._ignoreMove=!0;this.setOpacity(1);for(a=f.length-1;0<=a;a--){var g=f[a];d.removeLayer(g);g._preSpiderfyLatlng&&(g.setLatLng(g._preSpiderfyLatlng),
delete g._preSpiderfyLatlng);g.setZIndexOffset&&g.setZIndexOffset(0);g._spiderLeg&&(c.removeLayer(g._spiderLeg),delete g._spiderLeg)}b.fire("unspiderfied",{cluster:this,markers:f});b._ignoreMove=!1;b._spiderfied=null}});L.MarkerClusterNonAnimated=L.MarkerCluster.extend({_animationSpiderfy:function(a,b){var c,d=this._group,f=d._map,g=d._featureGroup,e=this._group.options.spiderLegPolylineOptions;d._ignoreMove=!0;for(c=0;c<a.length;c++){var h=f.layerPointToLatLng(b[c]);var m=a[c];var k=new L.Polyline([this._latlng,
h],e);f.addLayer(k);m._spiderLeg=k;m._preSpiderfyLatlng=m._latlng;m.setLatLng(h);m.setZIndexOffset&&m.setZIndexOffset(1E6);g.addLayer(m)}this.setOpacity(.3);d._ignoreMove=!1;d.fire("spiderfied",{cluster:this,markers:a})},_animationUnspiderfy:function(){this._noanimationUnspiderfy()}});L.MarkerCluster.include({_animationSpiderfy:function(a,b){var c,d,f,g=this,e=this._group,h=e._map,m=e._featureGroup,k=this._latlng,p=h.latLngToLayerPoint(k),r=L.Path.SVG,l=L.extend({},this._group.options.spiderLegPolylineOptions),
n=l.opacity;void 0===n&&(n=L.MarkerClusterGroup.prototype.options.spiderLegPolylineOptions.opacity);r?(l.opacity=0,l.className=(l.className||"")+" leaflet-cluster-spider-leg"):l.opacity=n;e._ignoreMove=!0;for(c=0;c<a.length;c++){var q=a[c];var u=h.layerPointToLatLng(b[c]);var v=new L.Polyline([k,u],l);h.addLayer(v);q._spiderLeg=v;r&&(d=v._path,f=d.getTotalLength()+.1,d.style.strokeDasharray=f,d.style.strokeDashoffset=f);q.setZIndexOffset&&q.setZIndexOffset(1E6);q.clusterHide&&q.clusterHide();m.addLayer(q);
q._setPos&&q._setPos(p)}e._forceLayout();e._animationStart();for(c=a.length-1;0<=c;c--)u=h.layerPointToLatLng(b[c]),q=a[c],q._preSpiderfyLatlng=q._latlng,q.setLatLng(u),q.clusterShow&&q.clusterShow(),r&&(v=q._spiderLeg,d=v._path,d.style.strokeDashoffset=0,v.setStyle({opacity:n}));this.setOpacity(.3);e._ignoreMove=!1;setTimeout(function(){e._animationEnd();e.fire("spiderfied",{cluster:g,markers:a})},200)},_animationUnspiderfy:function(a){var b,c,d,f,g,e=this,h=this._group,m=h._map,k=h._featureGroup;
a=a?m._latLngToNewLayerPoint(this._latlng,a.zoom,a.center):m.latLngToLayerPoint(this._latlng);var p=this.getAllChildMarkers(null,!0),r=L.Path.SVG;h._ignoreMove=!0;h._animationStart();this.setOpacity(1);for(b=p.length-1;0<=b;b--){var l=p[b];l._preSpiderfyLatlng&&(l.closePopup(),l.setLatLng(l._preSpiderfyLatlng),delete l._preSpiderfyLatlng,g=!0,l._setPos&&(l._setPos(a),g=!1),l.clusterHide&&(l.clusterHide(),g=!1),g&&k.removeLayer(l),r&&(c=l._spiderLeg,d=c._path,f=d.getTotalLength()+.1,d.style.strokeDashoffset=
f,c.setStyle({opacity:0})))}h._ignoreMove=!1;setTimeout(function(){var n=0;for(b=p.length-1;0<=b;b--)l=p[b],l._spiderLeg&&n++;for(b=p.length-1;0<=b;b--)l=p[b],l._spiderLeg&&(l.clusterShow&&l.clusterShow(),l.setZIndexOffset&&l.setZIndexOffset(0),1<n&&k.removeLayer(l),m.removeLayer(l._spiderLeg),delete l._spiderLeg);h._animationEnd();h.fire("unspiderfied",{cluster:e,markers:p})},200)}});L.MarkerClusterGroup.include({_spiderfied:null,unspiderfy:function(){this._unspiderfy.apply(this,arguments)},_spiderfierOnAdd:function(){this._map.on("click",
this._unspiderfyWrapper,this);this._map.options.zoomAnimation&&this._map.on("zoomstart",this._unspiderfyZoomStart,this);this._map.on("zoomend",this._noanimationUnspiderfy,this);L.Browser.touch||this._map.getRenderer(this)},_spiderfierOnRemove:function(){this._map.off("click",this._unspiderfyWrapper,this);this._map.off("zoomstart",this._unspiderfyZoomStart,this);this._map.off("zoomanim",this._unspiderfyZoomAnim,this);this._map.off("zoomend",this._noanimationUnspiderfy,this);this._noanimationUnspiderfy()},
_unspiderfyZoomStart:function(){this._map&&this._map.on("zoomanim",this._unspiderfyZoomAnim,this)},_unspiderfyZoomAnim:function(a){L.DomUtil.hasClass(this._map._mapPane,"leaflet-touching")||(this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._unspiderfy(a))},_unspiderfyWrapper:function(){this._unspiderfy()},_unspiderfy:function(a){this._spiderfied&&this._spiderfied.unspiderfy(a)},_noanimationUnspiderfy:function(){this._spiderfied&&this._spiderfied._noanimationUnspiderfy()},_unspiderfyLayer:function(a){a._spiderLeg&&
(this._featureGroup.removeLayer(a),a.clusterShow&&a.clusterShow(),a.setZIndexOffset&&a.setZIndexOffset(0),this._map.removeLayer(a._spiderLeg),delete a._spiderLeg)}});L.MarkerClusterGroup.include({refreshClusters:function(a){return a?a instanceof L.MarkerClusterGroup?a=a._topClusterLevel.getAllChildMarkers():a instanceof L.LayerGroup?a=a._layers:a instanceof L.MarkerCluster?a=a.getAllChildMarkers():a instanceof L.Marker&&(a=[a]):a=this._topClusterLevel.getAllChildMarkers(),this._flagParentsIconsNeedUpdate(a),
this._refreshClustersIcons(),this.options.singleMarkerMode&&this._refreshSingleMarkerModeMarkers(a),this},_flagParentsIconsNeedUpdate:function(a){var b,c;for(b in a)for(c=a[b].__parent;c;)c._iconNeedsUpdate=!0,c=c.__parent},_refreshSingleMarkerModeMarkers:function(a){var b;for(b in a){var c=a[b];this.hasLayer(c)&&c.setIcon(this._overrideMarkerIcon(c))}}});L.Marker.include({refreshIconOptions:function(a,b){var c=this.options.icon;return L.setOptions(c,a),this.setIcon(c),b&&this.__parent&&this.__parent._group.refreshClusters(this),
this}});t.MarkerClusterGroup=w;t.MarkerCluster=x});
